@use "sass:math";

/*
  Each utility in the utility map below has a prefix and a values map
  the values maps look like this (with base-size = 0.125rem) 

  (
    "0": 0rem
    "xxs": 0.125rem
    "xs": 0.25rem
    ... etc 
  )

  for all the values defined in the $spacing-vals map found in variables

  Then from these, classes are generated with the prefix
  so ultimately, for padding, for example, 
  we'll end up with:

  p-xs { 
    padding: 0.25rem
  }
  .p-s {
    padding: 0.5rem
  }
  ..etc

  Also for note for responsiveness those classes are 
  genereated too for the breakpoints like so:

  sm:p-xs {
    padding: 0.25rem
  }

  lg:p-s {
    padding: 0.5rem
  }
  ..etc

  Since the breakpoings are lower in ssu.css then the defaults, they will take 
  precidence

  As you can imagine, there's a lot of classes. Important
  to make sure purging is set up!  See online docs
*/

// Let's get started
// a helper function to fill out the spacings map found in variables file
// just builds a new map with the vals actuall css vals in rem
@function map-size-vals() {
  $return-map: ();

  @each $key, $val in $size-multipliers {
    $return-map: map-merge(
      $return-map,
      (
        $key: $base-size * $val
      )
    );
  }

  @return $return-map;
}

// A map of all the utility values I want
// some of the arrays of values are mapped with the
// previous function
$utilities: (
  "padding": (
    "prefix": "p",
    "values": map-size-vals()
  ),
  "padding-left": (
    "prefix": "p1",
    "values": map-size-vals()
  ),
  "padding-right": (
    "prefix": "pr",
    "values": map-size-vals()
  ),
  "padding-top": (
    "prefix": "pt",
    "values": map-size-vals()
  ),
  "padding-bottom": (
    "prefix": "pb",
    "values": map-size-vals()
  ),
  "margin": (
    "prefix": "m",
    "values": map-size-vals()
  ),
  "margin-left": (
    "prefix": "ml",
    "values": map-size-vals()
  ),
  "margin-right": (
    "prefix": "mr",
    "values": map-size-vals()
  ),
  "margin-top": (
    "prefix": "mt",
    "values": map-size-vals()
  ),
  "margin-bottom": (
    "prefix": "mb",
    "values": map-size-vals()
  ),
  "opacity": (
    "prefix": "o",
    "values": (
      "10": 0.1,
      "20": 0.2,
      "30": 0.3,
      "40": 0.4,
      "50": 0.5,
      "60": 0.6,
      "70": 0.7,
      "80": 0.8,
      "90": 0.9,
      "100": 1
    )
  ),
  "display": (
    "prefix": "d",
    "values": (
      "none": none,
      "block": block,
      "flex": flex,
      "inline": inline,
      "i-block": inline-block
    )
  ),
  "flex-direction": (
    "prefix": "flex",
    "values": (
      "row": row,
      "row-reverse": row-reverse,
      "col": column,
      "col-reverse": column-reverse
    )
  ),
  "flex-wrap": (
    "prefix": "flex",
    "values": (
      "wrap": wrap,
      "nowrap": nowrap,
      "wrap-reverse": wrap-reverse
    )
  ),
  "justify-content": (
    "prefix": "justify",
    "values": (
      "start": flex-start,
      "end": flex-end,
      "around": space-around,
      "between": space-between
    )
  ),
  "align-items": (
    "prefix": "items",
    "values": (
      "center": center,
      "start": flex-start,
      "end": flex-end,
      "stretch": stretch,
      "baseline": baseline
    )
  ),
  "align-content": (
    "prefix": "content",
    "values": (
      "between": space-between,
      "around": space-around,
      "stretch": stretch,
      "start": flex-start,
      "end": flex-end
    )
  ),
  "border-radius": (
    "prefix": "br",
    "values": $border-radiuses
  ),
  "box-shadow": (
    "prefix": "shadow",
    "values": $box-shadows
  ),
  "font-size": (
    "prefix": "font",
    "values": map-size-vals()
  ),
  "font-family": (
    "prefix": "font",
    "values": $fonts
  ),
  "font-weight": (
    "prefix": "font",
    "values": $font-weights
  ),
  "text-decoration": (
    "prefix": "text",
    "values": (
      "underline": underline,
      "overline": overline,
      "line-through": line-through
    )
  )
);

// Onto actually generating the utility classes..

// a function for getting the final utility class string
// looks like: p-4 or lg:ml-2 ., y'know, the utiltiy classes!
// see associated docs for full list
@function get-class-string($breakpointKey, $valueKey, $prefix) {
  $class-string: "";

  @if ($breakpointKey == "_") {
    @if ($valueKey == "default") {
      $class-string: #{$prefix};
    } @else {
      $class-string: #{$prefix} + "-" + #{$valueKey};
    }
  } @else {
    @if ($valueKey == "default") {
      $class-string: #{$breakpointKey} + "\\:"+ #{$prefix};
    } @else {
      $class-string: #{$breakpointKey} + "\\:"+ #{$prefix} + "-" + #{$valueKey};
    }
  }

  @return $class-string;
}

// a mixin that essentially generates a ton of classes
@mixin generate-classes($breakpointKey) {
  @each $property, $map in $utilities {
    $prefix: map-get($map, "prefix");
    $values: map-get($map, "values");

    @each $valueKey, $val in $values {
      $class-string: get-class-string($breakpointKey, $valueKey, $prefix);

      .#{$class-string} {
        #{$property}: $val;
      }
    }
  }
}

// finally, the magic happens here!
// warning: this is A LOT of css lol
// since the non-breakpoint classes are generated first,
// the breakpoint classes should overide when the breakpoitns are toggeled
@each $breakpointKey, $breakpointVal in $breakpoints {
  @if ($breakpointKey == "_") {
    @include generate-classes($breakpointKey);
  } @else {
    @include mediaQuery($breakpointKey) {
      @include generate-classes($breakpointKey);
    }
  }
}
